# WhatsUp

WhatsUp is a a event resolution method for co-occurring events in social media data. 

For more details about this approach, please refer to the paper "[WhatsUp: An Event Resolution Approach for Co-occurring Events in Social 
Media](https://www.sciencedirect.com/science/article/pii/S0020025523000014)"

If you use this system, please consider citing this paper; reference details are given below.

## About
This is a Python 3.7 implementation of WhatsUp. <br>
All the used packages are listed in [requirements.txt](https://github.com/HHansi/WhatsUp/blob/master/requirements.txt).

## Run the Code
Clone the repository and install the libraries using the following command (preferably inside a conda environment).
```
pip install -r requirements.txt
```
Also, make sure to download the necessary NLTK packages and set variables as mentioned in [requirements.txt](https://github.com/HHansi/WhatsUp/blob/master/requirements.txt).

Run WhatsUp full flow (full_flow function in [whatsup.py](https://github.com/HHansi/WhatsUp/blob/master/algo/whatsup.py)) given the following inputs.
* data_file_path (str): path to input data file
* args (JSON object): arguments for event detection <br>
A sample JSON created for Twitter-Event-Data-2019 is available in [args.py](https://github.com/HHansi/WhatsUp/blob/master/experiments/twitter_event_data_2019/args.py), and more details about the parameter selection can be found from the paper.
* we_args (JSON object): arguments to learn word embeddings <br>
A sample JSON created for Twitter-Event-Data-2019 is available in [args.py](https://github.com/HHansi/WhatsUp/blob/master/experiments/twitter_event_data_2019/args.py), and more details about the parameter selection can be found from the paper.
* output_folder_path (str): folder path to save outputs

### Input data file format
Input data file is a .tsv file formatted as follows:

* should contain a post (e.g. tweet) per line
* should contain 3 compulsory columns with headers: id, timestamp and text (any other column is ignored)
* timestamp should be formatted as %Y-%m-%d %H:%M:%S (e.g. 2019-10-20 15:25:00)

### Output folder format

Output folder will contain the following files and folders.

* cleaned.tsv - cleaned version of the input data file
* time-windows - folder of .tsv files/data per separate time windows
* word-embedding - folder of learned embedding models per time window
* stat - folder of extracted statistical information per time window
* results - folder of detected events with event windows

## Experiments
WhatsUp has experimented on [Twitter-Event-Data-2019](https://github.com/HHansi/Twitter-Event-Data-2019). Please refer to 
our paper for more details about the experiments and results. The codes used for experiments are available in 
[experiments](https://github.com/HHansi/WhatsUp/tree/master/experiments) folder.

None of the used data files is available in this repository due to the restrictions of [Twitter Developer Policy](https://developer.twitter.com/en/developer-terms/agreement-and-policy).
Please refer to the original data repository mentioned above to get access to the data.

### Evaluation
The evaluation framework developed along with this work is available in [evaluation](https://github.com/HHansi/WhatsUp/tree/master/experiments/twitter_event_data_2019/evaluation) folder.

By running evaluate_results function in [evaluate.py](https://github.com/HHansi/WhatsUp/blob/master/experiments/twitter_event_data_2019/evaluation/evaluate.py) given the following inputs:
* result_folder_path (str): path to the folder, which contains extracted events/results folder generated by running WhatsUp full flow <br>
In this folder, there should be separate folders for each time window. Within each time window folder, there should be individual .txt files for each event type named \<event-type\>.txt (e.g. emerging.txt).
Words/tokens of an event should be written per line of the corresponding .txt file, separated by ', '.

* groundtruth_folder_path (str): path to ground truth (GT) data folder <br>
This folder should contain separate folders for each targeted event type named using the event type (e.g. emerging). 
Within each event type folder, GT data should be included, following the same format used by the GT of [Twitter-Event-Data-2019](https://github.com/HHansi/Twitter-Event-Data-2019).

* type (str, optional): type of events that need to be evaluated <br>
This should match the event type used within the results folder. <br>
default value - 'emerging'

* eval_result_folder_path (str, optional): folder path to save matched event words in each time window <br>
default value - None,

the following metrics will be calculated, covering different levels of granularity.
* Time Window Recall
* Time Window Precision
* Time Window F1
* Event Recall
* Event Relevance
* Keyword Recall

More details about these metrics are available in the paper.

## Reference
```
@article{hettiarachchi2023whatsup,
title = {{W}hats{U}p: An event resolution approach for co-occurring events in social media},
journal = {Information Sciences},
volume = {625},
pages = {553-577},
year = {2023},
issn = {0020-0255},
doi = {https://doi.org/10.1016/j.ins.2023.01.001},
url = {https://www.sciencedirect.com/science/article/pii/S0020025523000014},
author = {Hansi Hettiarachchi and Mariam Adedoyin-Olowe and Jagdev Bhogal and Mohamed Medhat Gaber},
keywords = {Word embedding, Dendrograms, Clustering, Social media},
}
```
